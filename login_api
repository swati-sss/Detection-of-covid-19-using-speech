import Foundation

typealias PinLocationFetchCompletionHandler = (PinRenderedMessage) -> Void

protocol StoreMapLifecycleHandling: AnyObject, MessageParserDelegate {
    var mapViewDelegate: StoreMapsViewDelegate? { get set }
    var messageParser: MessageParsing { get }

    func viewDidAppear()
    func viewWillDisappear()
    func didConstructView()
    func didLoadWebView()
    func handleError()
    func getMapURLRequest() -> URLRequest?
}

protocol StoreMapMapHandling: AnyObject {
    func updateZoomLevel(with scale: CGFloat)
    func clearRenderedPin(mapConfig: MapConfig)
    func renderPins(from points: [CGPoint], config: DisplayPinConfig?)
    func renderPins(_ pins: [Pin], config: DisplayPinConfig?)
    func renderPins(_ request: RenderPinsRequest, config: DisplayPinConfig?)
    func zoomOut()
    func onStoreMapZoomChange(zoomType: ZoomActionType, _ completion: (() -> Void)?)
    func onStoreMapFloorChange(levelType: FloorLevelType, _ completion: (() -> Void)?)
}

protocol StoreMapNavigationHandling: AnyObject {
    func displayStaticPath(
        using renderPinsRequest: RenderPinsRequest,
        startFromNearbyEntrance: Bool,
        disableZoomGestures: Bool
    )
    func getUserDistance(_ request: GetPinLocationRequest, completion: PinLocationFetchCompletionHandler?)
    func updateUserPosition(x: Double, y: Double, accuracy: CGFloat?)
    func updateUserRotation(angle: CGFloat, rotateMap: Bool)
    func updateUserLoading(percentage: Int)
    func setPathfindingEnabled(_ enabled: Bool, duration: TimeInterval, force: Bool)
    func setPinSelectionEnabled(_ enabled: Bool)
    func setNavigation(enabled: inout Bool) -> Bool
    func canDisplayNavigationButton() -> Bool
}

typealias StoreMapViewInteracting = StoreMapLifecycleHandling & StoreMapMapHandling & StoreMapNavigationHandling

protocol StoreMapViewActionable: StoreMapViewInteracting {}
