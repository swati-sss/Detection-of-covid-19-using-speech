override func viewWillAppear(_ animated: Bool) {
    super.viewWillAppear(animated)
    
    // Check if map view needs to be restored
    if let containerView = mapRootViewController.view {
        
        // Remove from previous parent if needed
        if mapRootViewController.parent != nil && mapRootViewController.parent != self {
            mapRootViewController.willMove(toParent: nil)
            mapRootViewController.removeFromParent()
        }
        
        // Remove view from its current superview
        if containerView.superview != nil {
            containerView.removeFromSuperview()
        }
        
        // Re-add as child if needed
        if mapRootViewController.parent != self {
            addChild(mapRootViewController)
            mapRootViewController.didMove(toParent: self)
        }
        
        // Re-add to contentStackView if needed
        if !contentStackView.arrangedSubviews.contains(containerView) {
            // Find where to insert (before console view)
            if let consoleIndex = contentStackView.arrangedSubviews.firstIndex(of: consoleView) {
                contentStackView.insertArrangedSubview(containerView, at: consoleIndex)
            } else {
                contentStackView.insertArrangedSubview(containerView, at: 0)
            }
        }
        
        // Force layout update
        view.setNeedsLayout()
        view.layoutIfNeeded()
        
        // CRITICAL FIX: Re-display the map after view restoration
        // The map needs to be re-rendered after the view controller transfer
        if compass?.currentStore == currentStore {
            // Re-display the map with the same workflow
            compass?.displayMap(workflow: Workflow(id: "sample_app_id", type: "sample_app_flow", value: "sa_val"))
        }
    }
}
